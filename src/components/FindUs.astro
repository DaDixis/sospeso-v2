---
// FindUs component - Contact information and map
// Styled to match the Hero section
import { Card, CardContent } from '@/components/starwind/card';
import SectionWrapper from '@/components/shared/SectionWrapper.astro';
import SectionHeader from '@/components/shared/SectionHeader.astro';
import { Button } from '@/components/starwind/button';
---

<SectionWrapper id="hitta-oss">
		<Card class="overflow-hidden">
			<div class="grid grid-cols-1 md:grid-cols-2">
				<!-- Contact Info -->
				<CardContent class="p-6 sm:p-8">
					<SectionHeader title="Hitta Oss" spacing="mb-6" />
					
					<div class="space-y-4 mb-6">
						<!-- Email -->
						<a 
							href="mailto:micho@sospesosthlm.com" 
							class="flex items-center gap-3 group"
						>
							<div class="w-10 h-10 rounded-full bg-foreground/10 flex items-center justify-center group-hover:bg-foreground/20 transition-colors">
								<svg class="w-4 h-4 text-foreground" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
									<path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
								</svg>
							</div>
							<span class="text-base text-foreground group-hover:text-foreground/70 transition-colors">
								micho@sospesosthlm.com
							</span>
						</a>
						
						<!-- Phone -->
						<a 
							href="tel:+46736221611" 
							class="flex items-center gap-3 group"
						>
							<div class="w-10 h-10 rounded-full bg-foreground/10 flex items-center justify-center group-hover:bg-foreground/20 transition-colors">
								<svg class="w-4 h-4 text-foreground" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
									<path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
								</svg>
							</div>
							<span class="text-base text-foreground group-hover:text-foreground/70 transition-colors">
								+46 73 622 16 11
							</span>
						</a>
						
						<!-- Address -->
						<a 
							href="https://maps.google.com/?q=Värtavägen+31,+Stockholm+11529+Sverige" 
							target="_blank"
							rel="noopener noreferrer"
							class="flex items-center gap-3 group"
						>
							<div class="w-10 h-10 rounded-full bg-foreground/10 flex items-center justify-center group-hover:bg-foreground/20 transition-colors">
								<svg class="w-4 h-4 text-foreground" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
									<path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
									<path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
								</svg>
							</div>
							<div class="text-base text-foreground group-hover:text-foreground/70 transition-colors">
								<div>Värtavägen 31</div>
								<div class="text-sm text-muted-foreground">115 29 Stockholm</div>
							</div>
						</a>
					</div>
					
					<!-- CTA Button -->
					<Button 
						href="https://maps.google.com/maps/dir//Värtavägen+31,+Stockholm+11529+Sverige" 
						variant="default"
						size="sm"
						target="_blank"
						rel="noopener noreferrer"
						class="inline-block"
					>
						Få vägbeskrivning
					</Button>
				</CardContent>
				
				<!-- Map - lazy loaded -->
				<div class="aspect-square md:aspect-auto relative bg-muted" id="map-container">
					<div class="absolute inset-0 flex items-center justify-center" id="map-placeholder">
						<button 
							type="button"
							class="flex flex-col items-center gap-3 text-muted-foreground hover:text-foreground transition-colors"
							id="load-map-btn"
							aria-label="Ladda karta"
						>
							<svg class="w-12 h-12" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
								<path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
								<path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
							</svg>
							<span class="text-sm font-medium">Klicka för att ladda karta</span>
						</button>
					</div>
					<iframe 
						data-src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2033.8!2d18.0969!3d59.3498!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x465f9d5a5a5a5a5a%3A0x0!2sV%C3%A4rtav%C3%A4gen%2031%2C%20115%2029%20Stockholm!5e0!3m2!1sen!2sse!4v1699999999999!5m2!1sen!2sse"
						width="100%" 
						height="100%" 
						style="border:0;" 
						allowfullscreen="" 
						loading="lazy"
						referrerpolicy="no-referrer-when-downgrade"
						title="Sospeso location map"
						class="w-full h-full min-h-[300px] opacity-0 transition-opacity duration-300"
						id="map-iframe"
					></iframe>
				</div>
			</div>
		</Card>
	</SectionWrapper>
</section>

<script>
	function loadMap() {
		const iframe = document.getElementById('map-iframe') as HTMLIFrameElement;
		const placeholder = document.getElementById('map-placeholder');
		
		if (iframe && !iframe.src && iframe.dataset.src) {
			iframe.src = iframe.dataset.src;
			iframe.addEventListener('load', () => {
				iframe.classList.remove('opacity-0');
				iframe.classList.add('opacity-100');
				if (placeholder) {
					placeholder.style.display = 'none';
				}
			}, { once: true });
		}
	}

	// Load on button click
	const loadBtn = document.getElementById('load-map-btn');
	loadBtn?.addEventListener('click', loadMap);

	// Also load when section scrolls into view (intersection observer)
	const mapContainer = document.getElementById('map-container');
	if (mapContainer && 'IntersectionObserver' in window) {
		const observer = new IntersectionObserver((entries) => {
			entries.forEach((entry) => {
				if (entry.isIntersecting) {
					loadMap();
					observer.disconnect();
				}
			});
		}, { rootMargin: '100px' });
		observer.observe(mapContainer);
	}
</script>
